#!/usr/bin/env sh
# Husky post-commit hook
# Ensures auto-formatters' changes (staged in pre-commit) are included even when committing with a pathspec

# If nothing is staged, nothing to do
if git diff --cached --quiet; then
  exit 0
fi

# Avoid amending during merges or rebases
if [ -n "$(git rev-parse -q --verify MERGE_HEAD 2>/dev/null)" ]; then
  exit 0
fi

echo "ğŸ” Amending last commit to include auto-fixed files..."
# Skip hooks on the amend to prevent loops and re-running heavy checks
exec git commit --amend --no-edit --no-verify
